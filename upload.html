<!DOCTYPE html>
<html>
<head>
  <title>Clixly • Upload</title>
</head>
<body>
  <h2>Upload Post</h2>
  <input type="file" id="mediaInput" accept="image/*,video/*"><br><br>
  <button id="uploadBtn">Upload</button>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import {
      getFirestore, collection, addDoc, serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDNnoWHDiOUZWMlw-mMdlnDovEDR74zFew",
      authDomain: "clixly-bc284.firebaseapp.com",
      projectId: "clixly-bc284",
      storageBucket: "clixly-bc284.appspot.com",
      messagingSenderId: "33343695899",
      appId: "1:33343695899:web:25b8f943e077dfb1b85cbe"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const mediaInput = document.getElementById('mediaInput');
    const uploadBtn = document.getElementById('uploadBtn');

    uploadBtn.onclick = async () => {
      const file = mediaInput.files[0];
      if (!file) return alert("Please select a media file.");

      const formData = new FormData();
      formData.append("file", file);
      formData.append("upload_preset", "clixly_upload"); // ⚠️ Replace this
      formData.append("cloud_name", "dd1xg9duv");       // ⚠️ Replace this

      const isVideo = file.type.startsWith("video");

      try {
        const res = await fetch(`https://api.cloudinary.com/v1_1/dd1xg9duv/${isVideo ? 'video' : 'image'}/upload`, {
          method: "POST",
          body: formData
        });

        const data = await res.json();
        const url = data.secure_url;

        onAuthStateChanged(auth, async (user) => {
          if (!user) return alert("Login required");
          await addDoc(collection(db, "posts"), {
            userId: user.uid,
            [isVideo ? 'videoUrl' : 'imageUrl']: url,
            createdAt: serverTimestamp()
          });
          alert("Post uploaded!");
        });
      } catch (err) {
        console.error(err);
        alert("Upload failed.");
      }
    };
  </script>
</body>
</html>



